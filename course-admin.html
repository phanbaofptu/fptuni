<!DOCTYPE html>
<html>
  <head>
    <title>View Syllabus in FPT University</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <style>
      .labs{
        display: inline-block;
        width: 200px;
      }
    </style>
  </head>

  <body>
    <table class="table table-striped">
      <thead>
        <th>No</th>
        <th>SEMESTER</th>
        <th>COURSE ID</th>
        <th>COURSE NAME</th>
        <th>DETAIL</th>
        <th>CONTROL COURSE</th>
      </thead>
      <tbody id="tbody1">

      </tbody>
    </table>

<!-- Button trigger modal 
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" onlick="FillTboxes(null)">Add new Course</button>. -->
<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Control Panel</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <label class = "labs">Semester: </label>
        <input type = "number" id="SemesterMod"> <br>
        <label class = "labs">Course ID: </label>
        <input type = "text" id="CourseIDMod"> <br>
        <label class = "labs">Course Name: </label>
        <input type = "text" id="CourseNameMod"> <br>
        <label class = "labs">Detail: </label>
        <input type = "text" id="DetailMod"> <br>
      </div>
      <div class="modal-footer">
        <button id="DelModBtn" type="button" class="btn btn-danger" onclick="DelStd()">Delete</button>
        <button id="AddModBtn" type="button" class="btn btn-primary" onclick="AddStd()">Add new course</button>
        <button id="UpdModBtn" type="button" class="btn btn-success" onclick="UpdStd()">Update</button>
      </div>
    </div>
  </div>
</div>

    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-database.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
   
   <script id="MainScript">
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
var firebaseConfig = {
  apiKey: "AIzaSyAt18gtMamNVP2PXO3LYLfDRfACqarceFA",
  authDomain: "fptuni-baopg.firebaseapp.com",
  databaseURL: "https://fptuni-baopg-default-rtdb.firebaseio.com",
  projectId: "fptuni-baopg",
  storageBucket: "fptuni-baopg.appspot.com",
  messagingSenderId: "844102065495",
  appId: "1:844102065495:web:15aff8b2676b529ab1f212",
  measurementId: "G-XWHPCW0ED6"
};
firebase.initializeApp(firebaseConfig);

var CourseNo;
// GET ALL DATA
      function SelectAllData(){
        document.getElementById("tbody1").innerHTML="";
        CourseNo=0;
        firebase.database().ref('Syllabus').once('value',
        function(AllRecords){
          AllRecords.forEach(
            function(CurrentRecord){
              var Semester = CurrentRecord.val().Semester;
              var CourseID = CurrentRecord.val().CourseID;
              var CourseName = CurrentRecord.val().CourseName;
              var Detail = CurrentRecord.val().Detail;
              AddItemsToTable(Semester,CourseID,CourseName,Detail);
            }
          )
        }
        )
      }
      window.onload = SelectAllData;

//FILLING THE TABLE
var CourseNo = 0;
var stdList =[];
function AddItemsToTable(Semester,CourseID,CourseName,Detail){
  var tbody1 = document.getElementById('tbody1');
  var trow = document.createElement('tr');
  var td0 = document.createElement('td');
  var td1 = document.createElement('td');
  var td2 = document.createElement('td');
  var td3 = document.createElement('td');
  var td4 = document.createElement('td');
  stdList.push([Semester,CourseID,CourseName,Detail]);
  td0.innerHTML= ++CourseNo;
  td1.innerHTML= Semester;
  td2.innerHTML= CourseID;
  td3.innerHTML= CourseName;
  td4.innerHTML= Detail;
  
  trow.appendChild(td0); 
  trow.appendChild(td1); 
  trow.appendChild(td2); 
  trow.appendChild(td3); 
  trow.appendChild(td4); 

  var ControlDiv = document.createElement("div");
  ControlDiv.innerHTML = '<button type="button" class="btn btn-primary my-2" data-bs-toggle="modal" data-bs-target="#staticBackdrop" onlick="FillTboxes(null)">Add new course</button>'
  ControlDiv.innerHTML += '<button type="button" class="btn btn-primary my-2" data-bs-toggle="modal" data-bs-target="#staticBackdrop" onlick="FillTboxes('+CourseNo+')">Update the course</button>'

  trow.appendChild(ControlDiv);
  tbody1.appendChild(trow)
}

var ModSemester = document.getElementById('SemesterMod');
var ModCourseID = document.getElementById('CourseIDMod');
var ModCourseName = document.getElementById('CourseNameMod');
var ModDetail = document.getElementById('DetailMod');

var BTNmodAdd = document.getElementById('AddModBtn');
var BTNmodUpd = document.getElementById('UpdModBtn');
var BTNmodDel = document.getElementById('DelModBtn');

function FillTboxes(index){
  if(index==null){
    ModSemester.value = "";
    ModCourseID.value = "";
    ModCourseName.value = "";
    ModDetail.value = "";
    BTNmodAdd.style.display='inline-block';
    BTNmodUpd.style.display='none';
    BTNmodDel.style.display='none';
  }
  else{
    --index;
    ModSemester.value = stdList[index][0];
    ModCourseID.value = stdList[index][1];
    ModCourseName.value = stdList[index][2];
    ModDetail.value = stdList[index][3];
    ModCourseID.disabled=true;
    BTNmodAdd.style.display='none';
    BTNmodUpd.style.display='inline-block';
    BTNmodDel.style.display='inline-block';
  }
}
  function AddStd(){
    firebase.database().ref("Syllabus/"+ModCourseID.value).set(
      {
        Semester: ModSemester.value,
        CourseID: ModCourseID.value,
        CourseName: ModCourseName.value,
        Detail: ModDetail.value
      },
      (error) =>{
        if(error){
          alert("Đã xảy ra lỗi!");
        }
        else{
          alert("Đã thêm thành công môn học");
          SelectAllData();
          $("#exampleModalCenter").modal('hide');
        }
      }
    )
  }
  function UpdStd(){
    firebase.database().ref("Syllabus/"+ModCourseID).update(
      {
        Semester: ModSemester.value,
        CourseName: ModCourseName.value,
        Detail: ModDetail.value
      },
      (error) =>{
        if(error){
          alert("Đã xảy ra lỗi!");
        }
        else{
          alert("Đã cập nhật thành công môn học");
          SelectAllData();
          $("#exampleModalCenter").modal('hide');
        }
      }
    )
  }

  function DelStd(){
    firebase.database().ref("Syllabus/"+ModCourseID).remove().then(
      function(){
        alert("Môn học đã được xoá thành công!");
        SelectAllData();
        $("#exampleModalCenter").modal('hide');
      }
    )
  }

    </script>
  </body>
</html>